{% macro module_builder(modules, parent, lang) %}
    {% for module in modules %}   
        {% if module.idPadre == parent %}
            {% import _self as m_parent %}
            {% set isparent = m_parent.is_parent(modules, module.idModuloIxpo)|trim %}
            <div class="row module-row">
                <div class="col s2 m2 l2 offset-s{{(module.Nivel - 1)}} offset-m{{(module.Nivel - 1)}} offset-l{{(module.Nivel - 1)}}">
                    <div class="switch">
                        <label>
                            <input type="checkbox" class="module-check" id-record="{{module.idModuloIxpo}}" id-parent="{{module.idPadre}}" is-parent="{{isparent}}">
                            <span class="lever"></span>
                        </label>
                    </div>                                    
                </div>
                <div class="col s5 m5 l5">
                    <i class="material-icons circle">{{module.Icono}}</i><span class="module-name">{{ module['Modulo_' ~ lang|upper] }}</span>
                </div>
            </div>
            {% if isparent == 1 %}
                {{m_parent.module_builder(modules, module.idModuloIxpo, lang)}}
            {% endif %}
        {% endif %}
    {% endfor %}
{% endmacro %}

{% macro is_parent(modules, id) %}
    {% set flag = 0 %}
    {% for module in modules %}
        {% if module.idPadre == id %}
            {% set flag = 1 %}        
        {% endif %}
    {% endfor %}   
    {{ flag }}
{% endmacro%}